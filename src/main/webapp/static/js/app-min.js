(function(){if(!window.console){window.console={}}var a=["log","info","warn","error","debug","trace","dir","group","groupCollapsed","groupEnd","time","timeEnd","profile","profileEnd","dirxml","assert","count","markTimeline","timeStamp","clear"];for(var b=0;b<a.length;b++){if(!window.console[a[b]]){window.console[a[b]]=function(){}}}})();if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}$.fn.animateHighlight=function(e,c){var d=e||"#FFFF9C";var a=c||1500;var b=this.css("backgroundColor");this.fadeOut(50).fadeIn(50).fadeOut(50).fadeIn(50)};var eventDispatcher=_.extend({},Backbone.Events);var GLOBAL_EVENTS=GLOBAL_EVENTS||{CATEGORY_CHANGED:"categoryChanged",ITEM_CLICKED:"itemClicked",URL_CHANGED:"urlChanged"};var DIC=DIC||{timeout:[{pl:"Czas minął"},{en:"Timeout"}]};var utilsApp={}||utilsApp;utilsApp.encoder={encodeToURL:function(a){var b,d="ĄąĘęŚśŻżŹźÓóŁłŃń",c="AaEeSsZzZzOoLlNn";b=utilsApp.replace(d,c,a);return b}};utilsApp.replace=function(d,c,a){var b=a.replace(/ /g,"-");_.each(d.split(""),function(f,e,h){var g=new RegExp(f,"gi");b=b.replace(g,c[e+1])});return b};var textimageApp={}||textimageApp;textimageApp.model=Backbone.Model.extend({defaults:{baseURL:"/lukasfloorcom-1.0",category:"witamy",url:"http://localhost:8080/lukasfloorcom",fileName:"fruits",imageFileEnd:"png",textFileEnd:"txt"}});textimageApp.categoryPictureView=Backbone.View.extend({el:"#categoryIllustrator .zero",initialize:function(){eventDispatcher.on(GLOBAL_EVENTS.CATEGORY_CHANGED,this.eventsListener,this)},eventsListener:function(a){console.log("Image view picked up: "+a.itemId)},render:function(){},destroy:function(){eventDispatcher.off(GLOBAL_EVENTS.CATEGORY_CHANGED,this.eventsListener)}});textimageApp.categoryTextView=Backbone.View.extend({el:"#categoryIllustrator .zero",initialize:function(){eventDispatcher.on(GLOBAL_EVENTS.CATEGORY_CHANGED,this.eventsListener,this)},eventsListener:function(a){console.log("Text view picked up: "+a.itemId)},render:function(){},destroy:function(){eventDispatcher.off(GLOBAL_EVENTS.CATEGORY_CHANGED,this.eventsListener)}});var menuApp=menuApp||{};menuApp.menuView=Backbone.View.extend({isPushState:false,previousItemId:"30",currentItemId:"30",menuGroupsViews:[],el:"#nav",menuGroups:$("#nav").find("ul"),initialize:function(b){this.isPushState=b.isPushState;console.log("enablePushState is "+this.isPushState);eventDispatcher.on(GLOBAL_EVENTS.ITEM_CLICKED,this.eventsListener,this);eventDispatcher.on(GLOBAL_EVENTS.URL_CHANGED,this.eventsListener,this);var a=this;_.each(this.menuGroups,function(d,c,e){var f=new menuApp.groupView({$ul:$(d),index:c});a.menuGroupsViews.push(f)});console.log("app initialised")},eventsListener:function(c){var a=null;var b=this.getItemViewById(this.previousItemId);if(c.type===GLOBAL_EVENTS.ITEM_CLICKED){a=c.view;this.currentItemId=a.model.get("id");if(this.previousItemId===this.currentItemId){}else{a.addHighlight();b.removeHighlight();if(this.getGroupIndexFromId(this.previousItemId)===this.getGroupIndexFromId(this.currentItemId)){}else{console.log("group has changed to ");this.getGroupViewById(this.currentItemId).updateCategoryText();eventDispatcher.trigger(GLOBAL_EVENTS.CATEGORY_CHANGED,{itemId:this.getCurrentGroupIndex(),type:GLOBAL_EVENTS.CATEGORY_CHANGED})}}}this.previousItemId=this.currentItemId;if(c.type===GLOBAL_EVENTS.URL_CHANGED){console.log("path piced up");a=this.getItemViewByUrl(c.url);a.$el.trigger("click")}},countMenuGroups:function(){return this.menuGroups.length},countMenuGroupsViews:function(){return this.menuGroupsViews.length},countItemsInGroupByIndex:function(a){return this.getGroupByIndex(a).countLis()},getCurrentGroupIndex:function(){return this.getGroupIndexFromId(this.currentItemId)},getItemViewById:function(b){var a=b.split("");return this.menuGroupsViews[a[0]].itemViews[a[1]]},getItemViewByUrl:function(a){var c=null,d;for(var b=0;b<this.menuGroupsViews.length;b++){d=this.menuGroupsViews[b],c=d.getItemViewByUrl(a);if(c!==null){console.log("returning: "+c.model.get("text"));return c}}},getGroupViewById:function(b){var a=b.split("");return this.menuGroupsViews[a[0]]},getGroupIndexFromId:function(a){return a.split("")[0]},getGroupByIndex:function(a){var b=this.menuGroupsViews[a];return b},getGroupNameByIndex:function(a){return this.getGroupByIndex(a).getGroupName()},render:function(){},destroy:function(){_.invoke(this.menuGroupsViews,"destroy");eventDispatcher.off(GLOBAL_EVENTS.ITEM_CLICKED,this.eventsListener)}});menuApp.groupView=Backbone.View.extend({groupName:"",categoryTextDiv:"#categoryText",events:{},initialize:function(b){this.itemViews=[];this.$el=b.$ul;var a=this.$el.find("li");_.each(a,$.proxy(function(d,c,g){var j=$(d),i=b.index+""+c,h=$.trim(j.text());if(c===0){this.groupName=h}var e=new menuApp.menuItemModel({id:i,group:this.groupName,text:h});var f=new menuApp.itemView({model:e,$el:j});if(f.isGroup()){f.model.set({href:utilsApp.encoder.encodeToURL(this.groupName).toLowerCase()})}else{f.model.set({href:utilsApp.encoder.encodeToURL(this.groupName+"/"+h).toLowerCase()})}this.itemViews.push(f)},this))},listClicked:function(){console.log(" <ul> clicked ")},destroy:function(){_.invoke(this.itemViews,"destroy");console.log("off group "+this.groupName)},getItemViewByUrl:function(a){var c=null;for(var b=0;b<this.itemViews.length;b++){c=this.itemViews[b];if(c.model.get("href")===a){return c}}return null},countLis:function(){return this.itemViews.length},getGroupName:function(){return this.groupName},updateCategoryText:function(){$(this.categoryTextDiv).text(this.groupName)},render:function(){}});menuApp.menuItemModel=Backbone.Model.extend({defaults:{id:"",group:"not set",text:"not set",href:"",activeId:"",cssClass:""},initialize:function(){}});menuApp.itemView=Backbone.View.extend({activeClass:"toactive",events:{click:"itemClicked"},initialize:function(a){this.model=a.model;this.$el=a.$el;this.render()},render:function(){},addHighlight:function(){return this.$el.addClass(this.activeClass)},removeHighlight:function(){this.$el.removeClass(this.activeClass)},moveMenuPointer:function(){this.$el.fadeOut(50).fadeIn(50).fadeOut(100).fadeIn(50);var b=this.$el.offset();var a=this.$el.height();$("#menuPointer .heap").css({height:a+18});$("#menuPointer").offset({top:b.top+1,left:b.left+250})},getGroupName:function(){return this.model.get("group")},itemClicked:function(a){a.preventDefault();var d=this.model.get("id");eventDispatcher.trigger(GLOBAL_EVENTS.ITEM_CLICKED,{view:this,type:GLOBAL_EVENTS.ITEM_CLICKED});this.addHighlight();this.moveMenuPointer();var c=$.trim(this.model.get("text")),b=$.trim(this.model.get("group"));this.updateJestestu(b,c);this.updateTitle(c);this.sendGetRequest(b,c)},isGroup:function(){var b=["00","10","20","30"];var a=_.indexOf(b,this.model.get("id"));if(a===-1){return false}return true},updateJestestu:function(c,d){var a=$("#jestestu span"),b=" » ";if(c===d){a.text(c)}else{a.text(c+b+d)}},updateTitle:function(a){console.log("updating title? ");$("#contentContainer h1").text(a)},sendGetRequest:function(j){var a="lukasfloorcom-1.0/",b=false;var f=this.model.get("href");console.log(f);Backbone.history.navigate(a+f);var g=$(".ajaxSpinner").html();var h=$(".ajaxSpinner").html(" ");var e=$("#growl");e.empty();var i=function(k){e.append('<div class="errorMessage">'+k+"</div>");$(".errorMessage").fadeOut(4200)};var c=setTimeout(function(){h.html('<img class="spinner" src="'+rooturl+'/static/images/ajax-loading.gif"> ładuje ...</img>')},700);var d=$.ajax({url:rooturl+"/"+f,type:"get",dataType:"json",timeout:5000,beforeSend:function(l){console.log("sending AJAX ... "+this.url);var k=l},statusCode:{404:function(k){i("&nbsp Nie znaleziono (404)")}},success:function(k){console.log("success "+k.statusText)},error:function(k){console.log("error "+k.statusText)},complete:function(k){console.log("complete "+k.statusText)}}).done(function(k){console.log("done "+k.statusText)}).fail(function(k){b=true;console.log("fail 1 "+k.statuText)});d.always(function(k){clearTimeout(c);if(b){console.log("fail 2 "+k.statusText);h.html(g);i("Operacja nie powiodła się. Przepraszamy. ("+k.statusText+")");return}h.html("<p>"+k.text+'</p><img src="'+k.image+'">')})},destroy:function(){console.log("off item "+this.model.get("id"));this.$el.off();this.model.off()}});menuApp.MyRouter=Backbone.Router.extend({isPushState:false,initialize:function(a){this.isPushState=a.isPushState},routes:{"lukasfloorcom-1.0/":"rootpush","lukasfloorcom-1.0/schody":"schody","lukasfloorcom-1.0/schody/:usluga":"schody","/*":"rootnopush"},rootpush:function(){if(this.isPushState){eventDispatcher.trigger(GLOBAL_EVENTS.URL_CHANGED,{url:"witamy",type:GLOBAL_EVENTS.URL_CHANGED})}},rootnopush:function(){if(!this.isPushState){eventDispatcher.trigger(GLOBAL_EVENTS.URL_CHANGED,{url:"witamy",type:GLOBAL_EVENTS.URL_CHANGED})}},schody:function(a){console.log("router OK: "+a);if(a===undefined){eventDispatcher.trigger(GLOBAL_EVENTS.URL_CHANGED,{url:"schody",type:GLOBAL_EVENTS.URL_CHANGED})}else{eventDispatcher.trigger(GLOBAL_EVENTS.URL_CHANGED,{url:"schody/"+a,type:GLOBAL_EVENTS.URL_CHANGED})}}});$(function(){var f=true,d=!!(f&&window.history&&window.history.pushState);new textimageApp.categoryTextView;var e=new textimageApp.categoryPictureView();var c=new menuApp.menuView({isPushState:d}),b=new menuApp.MyRouter({isPushState:d}),a={pushState:d};Backbone.history.start(a)});